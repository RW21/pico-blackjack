pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
 make_players()
 make_deck()
 shuffle_cards(deck)
 loop_animations={}

 c1_animate_eyes=cocreate(animate_eyes(p1.c))
 c_animate=cocreate(animate(p1.c))
 add(loop_animations,c_animate)
 add(loop_animations,c1_animate_eyes)


end


function _update()
 --character animations
 for a in all(loop_animations) do
  coresume(a)
 end
  
  
end

function _draw()
 cls()

 print_card(deck[1])

 draw_player_zone(0,0,false)
 draw_border()
 draw_card(30,{suit=1,val=1,x=20,y=20})

 draw_c(p1.c)
end
-->8
card_map={
[1]=51,
[2]=17,
[3]=18,
[4]=19,
[5]=20,
[6]=32,
[7]=33,
[8]=34,
[9]=35,
[10]=36,
[11]=48,
[12]=49,
[13]=50
}
cs_map={
[1]=0,
[2]=1,
[3]=2,
[4]=3
}



function make_deck()
 deck={}
 for i=1,4 do 
  for j=1,13 do
   local card={suit=i,val=j,x=20,y=20}
   add(deck,card)
  end
 end
end

function random(i,j)
 --i,j inclusive
 return flr(rnd(j+1)+i)
end

function shuffle_cards(d)
 --fisher-yates shuffle
 for i = #d, 2, -1 do
  local j=random(0,i-1)
  d[i], d[j] = d[j], d[i]
 end
end

function print_card(card)
 local str=card["suit"].."-"..tostr(card["val"])
           .."-"..tostr(card["x"])..","..tostr(card["y"])
 print(str)
end

function draw_card(height,card)
 local x=card["x"]
 local y=card["y"]
 local width=height*0.7
 
 rectfill(x,y+3,x+width,y+height-3,7)
 --rounded edges
 spr(4,x,y-2)
 spr(4,x+width-7,y-2,1,1,true,false)
 rectfill(x+7,y-2,
 x+width-7,y+height-2,7)
 spr(4,x,y+height-4,1,1,false,true)
 spr(4,x+width-7,y+height-4,1,1,true,true)
 rectfill(x+7,y+height-4,
 x+width-7,y+height+3,7)
 
 spr(card_map[card["val"]],x+2,y+2)
 spr(card_map[card["val"]],x+width-8,y+height-8,
     1,1,false,true)
 spr(cs_map[card["suit"]],x+width/2-4,y+height/2-4)
end



function draw_suit(x,y,col)
end

function arrange_suits(s,val)
end
-->8
c1={
 x_start=95,
 y_start=0,
 x_end=128,
 y_end=63,
 
 x_pos=90,
 y_pos=60,
 x_offset=0,
 y_offset=0,
 
 eyes_size={x=4,y=5},
 eye_l_pos={x=4,y=20},
 eyes_l={
 {x=98,y=20},
 {x=89,y=0},
 {x=89,y=5},
 {x=89,y=10}
 },
 eyes_stg=1
 
}

function draw_c(c)
 sspr(c.x_start,c.y_start,
      c.x_end-c.x_start,
      c.y_end-c.y_start,
      c.x_pos+c.x_offset,
      c.y_pos+c.y_offset)
 --eyes
 local a=c.x_start
 print(c.eyes_stg)
 print(c.eyes_l[c.eyes_stg]["x"])
print(c.eyes_l[c.eyes_stg]["y"])
 sspr(
 c.eyes_l[c.eyes_stg]["x"],
 c.eyes_l[c.eyes_stg]["y"],
 c.eyes_size["x"],
 c.eyes_size["y"],
 c.eye_l_pos["x"]+c.x_offset+c.x_pos,
 c.eye_l_pos["y"]+c.y_offset
 )
 --rectfill(
 --a+c.eyes_l[c.eyes_stg]["x"],
 
 
 
 
end

function animate_eyes(c)
 function a()
  while true do
   for i=0,2,0.1 do
    c.eyes_stg=ceil(sin(i)+1)
    --stop()
    yield()
   end
    c.eyes_stg=1
    yield()
  end
 end
  
 return a
end

function animate(c)
 function a()
  while true do
   for i=0,2,0.01 do
    c.y_offset=cos(i)*2
   	yield()
   end
  end
  c.y_offset=0
  yield()
 end
 return a
end

-->8
function make_players()
 local temp={
 coin=50,
 c=c1
 }
 --p1,p2,p3,p4=temp,temp,temp,temp
 p1={c=c1}
 p1.c.x_pos=32
 p1.c.y_pos=0
end

function draw_player_zone(x,y,x_mir)
 --rectfill(x,y,x+64,y+64,3)
 --spr(64,x,y,64,64,false,false)
 for i=x,x+64,8 do
  for j=y,y+64,8 do
   spr(64,i,j)
  end
 end
end

function draw_border()
 local n=65
 --vertical
 line(0,64,128,64,4)
 line(0,63,128,63,5)
 line(0,65,128,65,5)
 --horizontal
 line(64,0,64,128,4)
 line(63,0,63,128,5)
 line(65,0,65,128,5)
end
__gfx__
77111177777117777778777788877887007777770000000000000000000000000000000000000000000000000fffff0000005050000555000000000000000000
77711777711111177788877788878888077777770000000000000000000000000000000000000000000000000f111f0000005555555555555500000000000000
71171717711111177888887788888888777777770000000000000000000000000000000000000000000000000ff1110000000555555555555550000000000000
11111111111111118888888778888887777777770000000000000000000000000000000000000000000000000ff1170000005555555555555555500000000000
11111111111111118888888777888877777777770000000000000000000000000000000000000000000000000ff1550000055555555555555555555000000000
11111111117117117888887777888777777777770000000000000000000000000000000000000000000000000fffff0000555555555555555555555550000000
71171717777177777788877777887777777777770000000000000000000000000000000000000000000000000fffff0000555555555555555555555550000000
77717777771117777778777777887777777777770000000000000000000000000000000000000000000000000f11110005555555555555555555555555000000
77711f777711117777111117771111f77111111f7777777777777777777700000000000000000000000000000ff1110005555555555555555555555555000000
77111f77711ff177711ff11f777f1ff7711fffff7777777777777777777700000000000000000000000000000ff1150055555555555555555555555555000000
77771f7771f7711f77ff711f71171777717777777777777777777777777700000000000000000000000000000fffff0055555555555555555555555555500000
77771f77777711f7777117ff11ff1177711111177777777777777777777700000000000000000000000000000fffff0055555555555555955555555555500000
777111f77777f1777777f1171111111f7fff11117777777777777777777700000000000000000000000000000fffff0555555559555559555555555555550000
77771f777771171771777f117fff1fff71ffff117777777777777777777700000000000000000000000000000f11110555555559555595555555555555550000
77711f777711711f7117771f77711f777117711f7777777777777777777700000000000000000000000000000ff1110555555595555595555555955555550000
771111177111111f771111f7771111f7771111f77777777777777777777700000000000000000000000000000fffff0555595595555f95555559555555550000
777000771111111f7711177777777777777711770000000000000000000000000000000000000000000000000fffff00559f1115555f95551119555555555000
711ff00f71fff11f7711717777117777771711170000000000000000000000000000000000000000000000000ff11100559ffff1599ff5519911555555555000
11f7ff0f11f711ff7717717777111177717717170000000000000000000000000000000000000000000000000f171f00055ffffffffffffffffff55555555000
11f111ff7ff71ff77711117777711177717717170000000000000000000000000000000000000000000000000f115f00555ffffffffffffffffff95555555000
1111f11777711f777711177777777177711717170000000000000000000000000000000000000000000000000f155f005551111fffffffff1111f95555555000
11ff711f7771ff777711117777777177717711170000000000000000000000000000000000000000000000000fffff00055ff111fffffff1111ff95555550000
1117111f7711f7777771117777777177717717770000000000000000000000000000000000000000000000000fffff00055ff171ffffffff171ff99555550000
711111ff71111f777777777777777177777777770000000000000000000000000000000000000000000000000fffff00055ff115ffffffff115ff95555550000
77777777717777777777777700011000777777770000000000000000000000000000000000000000000000000ff11100055ff155ffffffff155fff9555550000
77111177717111777717717700111100777777770000000000000000000000000000000000000000000000000f111f00055ffffffffffffffffffff955550000
771111177111771177171777011ff110777777770000000000000000000000000000000000000000000000000f155f00055ffffff9fffffff9f9fff995550000
77111117711177717711777701f0011f777777770000000000000000000000000000000000000000000000000fffff00055f98ff5fffffffff88fff995550000
77111117711171777711177701111111777777770000000000000000000000000000000000000000000000000fffff000555fffffffffffffffffff555550000
711111777171171777171177011ff111777777770000000000000000000000000000000000000000000000000fffff0000555fffffffffffffffff5555550000
11111117777117117717711701ff0111777777770000000000000000000000000000000000000000000000000fffff00005555ffffffffffffff955555955000
17711717777711117777771711f00111777777770000000000000000000000000000000000000000000000000ff11f000055555ffff555fffff9955955555000
33333333444494440000000000000000000000000000000000000000000000000000000000000000000000000f115f0000955555ffffffffff99955955595000
3b3333334444444400000000000000000000000000000000000000000000000000000000000000000000000000000000055595595fffffff9999955559505500
3b33333b4f44449400000000000000000000000000000000000000000000000000000000000000000000000000000000055595955555f9999999955599500000
3333333b9444944400000000000000000000000000000000000000000000000000000000000000000000000000000000050500555557fff99999775559550000
3333333344f4944900000000000000000000000000000000000000000000000000000000000000000000000000000000050500555577ffff1197775555955000
33b3333349444f9400000000000000000000000000000000000000000000000000000000000000000000000000000000000505551111ff111197775555095500
333333334494494400000000000000000000000000000000000000000000000000000000000000000000000000000000000505007111f1161177776555000000
333333b34444444400000000000000000000000000000000000000000000000000000000000000000000000000000000005050ff716111611177767775500000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff711111161166677777700000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff7711767111177777777770000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff7777776611177777777990000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff7777766777777777779999000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff77776777777777777999ff000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777577777777766999fff000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff77777777777777669ffffff000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff77777777777777779ffffff000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff77777777777777669ffffff000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff777777777777777769ffffff000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff777775777777777769ffffff000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff777777777777777769ffffff000
000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000ff777777777777777769ffffff000
000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000ff77677777777777666fffffff000
00000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000ffff6667776777766766ffffff0000
00000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000ffff7667777666667766ffffff0000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777577667667766ffffff0000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777777777777766ffffff0000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777777777777766ffffff0000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777777777777766ffffff0000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777777777777666ffffff0000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777777777777666ffffff0000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777777777777666ffffff0000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff7777777777777777ffffff0000
000000000000000000000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000020212223242526270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000030313233343536370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000040414243444546470000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000050515253545556570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000060616263646566670000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000070717273747576770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000010203040506070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000010111213141516170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000020212223242526270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
